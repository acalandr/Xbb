;!! -----------------------------
;!! Config for the MVA training
;!! -----------------------------

[MVAGeneral]
ntupleVersion = V11final
type = BDT
SettingsAll_lowd = !H:!V:NTrees=400:nEventsMin=200:MaxDepth=3:BoostType=AdaBoost:AdaBoostBeta=0.1:SeparationType=MisClassificationError:nCuts=15:PruneMethod=NoPruning
SettingsAll_highd = !H:!V:NTrees=400:nEventsMin=200:MaxDepth=3:BoostType=AdaBoost:AdaBoostBeta=0.1:SeparationType=MisClassificationError:nCuts=15:PruneMethod=NoPruning

[factory]
factoryname = MVA
factorysettings = !V:Color:!DrawProgressBar:AnalysisType=Classification:Transformations=I

[MVALists]
List_for_submitscript = <!MVALists|List!>

List = SR_low_Zll,SR_medhigh_Zll,VV_SR_low_Zll,VV_SR_medhigh_Zll,SR_lowmedhigh_Zll,VV_SR_lowmedhigh_Zll
List_Multi = Multi_medhigh_Zll,Multi_low_Zll
List_for_submitscript_boost = BDT_Zll_BOOSTFinal_wdB 

;====================

[SR_low_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = SR_low_Zll 
branchName       = BDT_DNN2017V11_ZllLow_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllLow_SR_v2/model.ckpt
signalIndex      = 0
# Table[Exp[-(x - 0.15)^2/0.17], {x, 0, 0.99, 1/15.0}]
bins             = [0.0000, 0.0119, 0.0396, 0.0828, 0.1512, 0.2469, 0.3626, 0.4972, 0.6218, 0.7307, 0.8106, 0.8667, 0.9088, 0.9385, 0.9648, 1.0001]

[SR_med_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = SR_med_Zll 
branchName       = BDT_DNN2017V11_ZllHigh_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllHigh_SR_v2/model.ckpt        
signalIndex      = 0
bins             = <!SR_medhigh_Zll|bins!> 

[SR_high_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = SR_high_Zll 
branchName       = BDT_DNN2017V11_ZllHigh_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllHigh_SR_v2/model.ckpt        
signalIndex      = 0
bins             = <!SR_medhigh_Zll|bins!> 

[SR_medhigh_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = SR_medhigh_Zll 
branchName       = BDT_DNN2017V11_ZllHigh_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllHigh_SR_v2/model.ckpt        
signalIndex      = 0
# Table[Exp[-(x - 0.15)^2/0.17], {x, 0, 0.99, 1/15.0}]
bins             = [0.0000, 0.0105, 0.0293, 0.0666, 0.1288, 0.2278, 0.3517, 0.4763, 0.5994, 0.7238, 0.8183, 0.8820, 0.9235, 0.9509, 0.9695, 1.0001]

[SR_lowmedhigh_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = SR_lowmedhigh_Zll 
signalIndex      = 0

# VV

[VV_SR_low_Zll]
signals          = [<!Plot_general|VVSIG!>]
backgrounds      = [<!Plot_general|VVBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = VV_SR_low_Zll 
branchName       = BDT_DNN2017V11_ZllLow_VV_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllLow_VV_SR_v2/model.ckpt        
#bins             = XbbTools.readJson("<!.|checkpoint!>.bins.json")
bins             = [0.0000, 0.0230, 0.0509, 0.0955, 0.1620, 0.2588, 0.3838, 0.4870, 0.6061, 0.7170, 0.7990, 0.8562, 0.8935, 0.9212, 0.9452, 1.0001]
signalIndex      = 0

[VV_SR_medhigh_Zll]
signals          = [<!Plot_general|VVSIG!>]
backgrounds      = [<!Plot_general|VVBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = VV_SR_medhigh_Zll 
branchName       = BDT_DNN2017V11_ZllHigh_VV_SR_v2
checkpoint       = DNN/191010_DNN2017V11_ZllHigh_VV_SR_v2/model.ckpt        
#bins             = XbbTools.readJson("<!.|checkpoint!>.bins.json")
bins             = [0.0000, 0.0047, 0.0157, 0.0380, 0.0869, 0.1857, 0.3414, 0.4891, 0.6167, 0.7424, 0.8299, 0.8893, 0.9255, 0.9513, 0.9699, 1.0001]
signalIndex      = 0

[VV_SR_lowmedhigh_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = VV_SR_lowmedhigh_Zll 
signalIndex      = 0

[Multi_low_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = Multi_low_Zll  
classes          = <!Multi|classes!> 
# V1
#checkpoint       = DNN/190729_DNN2017V11_Zll_low_Multi_v1/model.ckpt
#branchName       = BDT_DNN2017V11_Zll_low_Multi_v1
#bins             = [0.,0.397891,0.511363,0.606735,0.693823,1.,1.30303,1.36955,1.44355,1.53162,2.,2.36442,2.46974,2.60091,2.76096,3.,3.46475,3.52727,3.56773,3.61948,4.,4.51432,4.58117,4.63997,4.70022,5.,5.3324,5.40796,5.47987,5.60632,6.,6.3231,6.41547,6.50128,6.61199,7.,7.2868,7.339,7.4022,7.4725,7.5613,7.6676,7.7653,7.8484,7.9089,7.9402,7.9562,7.9655,7.9733,7.9813,8.0001]
checkpoint       = DNN/190817_DNN2017V11_ZllLow_Multi_v2/model.ckpt
branchName       = BDT_DNN2017V11_Zll_low_Multi_v2
bins             = [0.,0.446438,0.561809,0.650427,0.729638,1.,1.3449,1.43803,1.53681,1.66684,2.,2.40118,2.52538,2.67033,2.80837,3.,3.46281,3.53989,3.6128,3.7146,4.,4.52733,4.61632,4.6899,4.76189,5.,5.35278,5.44648,5.53722,5.64655,6.,6.35688,6.45984,6.58774,6.7189,7.,7.3061,7.3668,7.4242,7.4841,7.5505,7.6222,7.6961,7.7667,7.819,7.8584,7.8824,7.9012,7.9202,7.9376,8.0001]

[Multi_medhigh_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = Multi_medhigh_Zll  
classes          = <!Multi|classes!> 
# V1
#checkpoint       = DNN/190729_DNN2017V11_Zll_medhigh_Multi_v1/model.ckpt
#branchName       = BDT_DNN2017V11_Zll_medhigh_Multi_v1
#bins             = [0.,0.380852,0.473842,0.555245,0.642126,1.,1.27376,1.30874,1.33709,1.3798,2.,2.39658,2.48823,2.58142,2.68148,3.,3.47351,3.55331,3.66228,3.82205,4.,4.54047,4.66069,4.79858,4.90418,5.,5.33178,5.40421,5.4808,5.59976,6.,6.37847,6.47344,6.57266,6.68462,7.,7.321,7.3789,7.44,7.4984,7.5658,7.6563,7.7686,7.8718,7.9394,7.966,7.9777,7.9839,7.9883,7.9917,8.0001] 
checkpoint       = DNN/190819_DNN2017V11_ZllHigh_Multi_v3/model.ckpt
branchName       = BDT_DNN2017V11_Zll_medhigh_Multi_v3
bins             = [0.,0.401045,0.50343,0.58591,0.666407,1.,1.30916,1.36238,1.41256,1.47701,2.,2.38741,2.49317,2.61643,2.74238,3.,3.48067,3.5668,3.67691,3.83365,4.,4.55025,4.70188,4.84124,4.94039,5.,5.34379,5.41848,5.50316,5.64805,6.,6.38856,6.49765,6.617,6.73748,7.,7.,7.2931,7.3373,7.3831,7.4336,7.4971,7.5862,7.6924,7.7997,7.8869,7.9407,7.9643,7.9766,7.9835,7.9894,8.0001] 

[Multi_all_Zll]
signals          = [<!Plot_general|allSIG!>]
backgrounds      = [<!Plot_general|allBKG!>]
treeVarSet       = ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut          = Multi_all_Zll
branchName       = BDT_DNN2017V11_STXS_Zll_Test
classes          = <!Multi|classes_stxs!> 

# Mjj

[Mjj_SR_low_Zll]
signals:          [<!Plot_general|allSIG!>]
backgrounds:      [<!Plot_general|allBKG!>]
treeVarSet:       ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut:          SR_low_Zll
branchName:       BDT_DNN2017V11_ZllLow_Mjj_v1
checkpoint:       DNN/190826_DNN2017V11_ZllLow_Mjj_v1/model.ckpt
signalIndex:      0

[Mjj_SR_medhigh_Zll]
signals:          [<!Plot_general|allSIG!>]
backgrounds:      [<!Plot_general|allBKG!>]
treeVarSet:       ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut:          SR_medhigh_Zll
branchName:       BDT_DNN2017V11_ZllHigh_Mjj_v1
checkpoint:       DNN/190826_DNN2017V11_ZllHigh_Mjj_v1/model.ckpt
signalIndex:      0


# test

[ZllBDT_highpt_LL]
MVAtype:          <!MVAGeneral|type!>
MVAsettings:      <!MVAGeneral|SettingsAll_highd!>
signals:          [<!Plot_general|allSIG!>]
backgrounds:      [<!Plot_general|allBKG!>]
data:             <!Plot_general|Data!>
treeVarSet:       ZllBDTVarsDeepCSV_LL
treeCut:          ZllBDT_highpt
branchName:       ZllBDT_highpt_DNN2017
folder:           XBB_2017_Highpt_LL
h5:               dumps/Zll2017_ZllBDT_highpt2017_18_181112.h5 
tensorflowConfig: tfZllDNN/export/<!.|folder!>/config.cfg
scalerDump:       tfZllDNN/export/<!.|folder!>/scaler.dmp
checkpoint:       tfZllDNN/export/<!.|folder!>/checkpoints/model.ckpt
signalIndex:      0

[ZllBDT_highpt_HFCR]
signals:           [<!Plot_general|allSIG!>]
backgrounds:       [<!Plot_general|allBKG!>]
data:              <!Plot_general|Data!>
classes:           [['ZLIGHT',[<!Plot_general|DY_0b!>,<!Plot_general|VVLF!>,<!Plot_general|VVHF!>,<!Plot_general|ZHsignal!>,<!Plot_general|ggZHsignal!>,<!Plot_general|WHsignal!>]],['ZB',[<!Plot_general|DY_1b!>]],['ZBB',[<!Plot_general|DY_2b!>]],['ST',[<!Plot_general|ST!>]],['TT',[<!Plot_general|TT!>]]]
treeVarSet:        ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut:           Zll_CRZb_highpt
branchName_REG:    BDT_DNN_XBB_2017_ZllHigh_HFCR_190423 
branchName_KINFIT: BDT_DNN_XBB_2017_ZllHigh_HFCR_KINFIT_190403
branchName:        <!.|branchName_<!General|Htype!>!>
folder_KINFIT:     XBB_2017_ZllHigh_HFCR_KINFIT_190423
folder_REG:        XBB_2017_ZllHigh_HFCR_190423
folder:            <!.|folder_<!General|Htype!>!>
tensorflowConfig:  DNN/HFCR/<!.|folder!>/config.cfg

[ZllBDT_lowpt_HFCR]
signals:           [<!Plot_general|allSIG!>]
backgrounds:       [<!Plot_general|allBKG!>]
data:              <!Plot_general|Data!>
classes:           [['ZLIGHT',[<!Plot_general|DY_0b!>,<!Plot_general|VVLF!>,<!Plot_general|VVHF!>,<!Plot_general|ZHsignal!>,<!Plot_general|ggZHsignal!>,<!Plot_general|WHsignal!>]],['ZB',[<!Plot_general|DY_1b!>]],['ZBB',[<!Plot_general|DY_2b!>]],['ST',[<!Plot_general|ST!>]],['TT',[<!Plot_general|TT!>]]]
treeVarSet:        ZllBDTVars<!General|btagMethod!>_<!General|Htype!>
treeCut:           Zll_CRZb_lowpt
branchName_REG:    BDT_DNN_XBB_2017_ZllLow_HFCR_190423
branchName_KINFIT: BDT_DNN_XBB_2017_ZllLow_HFCR_KINFIT_190423
branchName:        <!.|branchName_<!General|Htype!>!>
folder_KINFIT:     XBB_2017_ZllLow_HFCR_KINFIT_190423
folder_REG:        XBB_2017_ZllLow_HFCR_190423
folder:            <!.|folder_<!General|Htype!>!>
tensorflowConfig:  DNN/HFCR/<!.|folder!>/config.cfg


;===========================
;Variables for training and evaluation
;===========================
[ZllBDTVarsDeepCSV_KINFIT_WP]
Nominal = kinFit_H_mass_fit H_mass kinFit_H_pt_fit H_pt kinFit_HVdPhi_fit abs(VHbb::deltaPhi(H_phi,V_phi)) (Jet_btagDeepB[hJidx[0]]>0.1522)+(Jet_btagDeepB[hJidx[0]]>0.4941)+(Jet_btagDeepB[hJidx[0]]>0.8001) (Jet_btagDeepB[hJidx[1]]>0.1522)+(Jet_btagDeepB[hJidx[1]]>0.4941)+(Jet_btagDeepB[hJidx[1]]>0.8001) kinFit_hJets_pt_0_fit Jet_PtReg[hJidx[0]] kinFit_hJets_pt_1_fit Jet_PtReg[hJidx[1]] kinFit_V_mass_fit V_mass Sum$(Jet_Pt>30&&abs(Jet_eta)<2.4&&(Jet_puId>6||Jet_Pt>50)&&Jet_jetId>0&&Jet_lepFilter>0&&Iteration$!=hJidx[0]&&Iteration$!=hJidx[1]) kinFit_V_pt_fit V_pt kinFit_jjVPtRatio_fit (H_pt/V_pt) abs(Jet_eta[hJidx[0]]-Jet_eta[hJidx[1]]) SA5 VHbb::deltaR(kinFit_H_eta_fit,kinFit_H_phi_fit,kinFit_V_eta_fit,kinFit_V_phi_fit) VHbb::deltaR(H_eta,H_phi,V_eta,V_phi) MET_Pt kinFit_H_mass_sigma_fit kinFit_n_recoil_jets_fit VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[hJidx[1]],Jet_phi[hJidx[1]])

# uses both variables
[ZllBDTVarsDeepCSV_KINFIT]
Nominal = kinFit_H_mass_fit H_mass kinFit_H_pt_fit H_pt kinFit_HVdPhi_fit abs(VHbb::deltaPhi(H_phi,V_phi)) Jet_btagDeepB[hJidx[0]] Jet_btagDeepB[hJidx[1]] kinFit_hJets_pt_0_fit Jet_PtReg[hJidx[0]] kinFit_hJets_pt_1_fit Jet_PtReg[hJidx[1]] kinFit_V_mass_fit V_mass Sum$(Jet_Pt>30&&abs(Jet_eta)<2.4&&(Jet_puId>6||Jet_Pt>50)&&Jet_jetId>0&&Jet_lepFilter>0&&Iteration$!=hJidx[0]&&Iteration$!=hJidx[1]) kinFit_V_pt_fit V_pt kinFit_jjVPtRatio_fit (H_pt/V_pt) abs(Jet_eta[hJidx[0]]-Jet_eta[hJidx[1]]) SA5 VHbb::deltaR(kinFit_H_eta_fit,kinFit_H_phi_fit,kinFit_V_eta_fit,kinFit_V_phi_fit) VHbb::deltaR(H_eta,H_phi,V_eta,V_phi) MET_Pt kinFit_H_mass_sigma_fit kinFit_n_recoil_jets_fit VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[hJidx[1]],Jet_phi[hJidx[1]])


[ZllBDTVarsDeepCSV_KINFITONLY]
Nominal = kinFit.H_mass_fit_fallback kinFit.H_pt_fit_fallback kinFit.HVdPhi_fit_fallback Jet_btagDeepB[hJidx[0]] Jet_btagDeepB[hJidx[1]] kinFit.hJets_pt_0_fit_fallback kinFit.hJets_pt_1_fit_fallback kinFit.V_mass_fit Sum$(Jet_PtReg>30&&abs(Jet_eta)<2.4&&(Jet_puId>6||Jet_Pt>50)&&Jet_jetId>0&&Jet_lepFilter>0&&Iteration$!=hJidx[0]&&Iteration$!=hJidx[1]) kinFit.V_pt_fit kinFit.jjVPtRatio_fit_fallback abs(Jet_eta[hJidx[0]]-Jet_eta[hJidx[1]]) SA5 VHbb::deltaR(kinFit.H_eta_fit,kinFit.H_phi_fit,kinFit.V_eta_fit,kinFit.V_phi_fit) MET_Pt kinFit.H_mass_sigma_fit kinFit.n_recoil_jets_fit VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[hJidx[1]],Jet_phi[hJidx[1]]) 

[ZllBDTVarsDeepCSV_REG]
Nominal = H_mass H_pt abs(VHbb::deltaPhi(H_phi,V_phi)) Jet_btagDeepB[hJidx[0]] Jet_btagDeepB[hJidx[1]] Jet_PtReg[hJidx[0]] Jet_PtReg[hJidx[1]] V_mass Sum$(Jet_PtReg>30&&abs(Jet_eta)<2.4&&(Jet_puId>6||Jet_Pt>50)&&Jet_jetId>0&&Jet_lepFilter>0&&Iteration$!=hJidx[0]&&Iteration$!=hJidx[1]) V_pt (H_pt/V_pt) abs(Jet_eta[hJidx[0]]-Jet_eta[hJidx[1]]) SA5 VHbb::deltaR(H_eta,H_phi,V_eta,V_phi) MET_Pt VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[hJidx[1]],Jet_phi[hJidx[1]])

[ZllBDTVarsDeepCSV_LL]
Nominal = (H_pt/V_pt) -isZee+isZmm abs(Jet_eta[hJidx[0]]-Jet_eta[hJidx[1]]) abs(VHbb::deltaPhi(H_phi,V_phi)) aJidx_202p5[0]>=0 aJidx_202p5[1]>=0 aJidx_202p5[2]>=0 Alt$(Electron_eta[vLidx[0]]*isZee,0)+Alt$(Muon_eta[vLidx[0]]*isZmm,0) Alt$(Electron_eta[vLidx[0]]*isZee,0)+Alt$(Muon_eta[vLidx[0]]*isZmm,0)-Alt$(Electron_eta[vLidx[1]]*isZee,0)-Alt$(Muon_eta[vLidx[1]]*isZmm,0) Alt$(Electron_eta[vLidx[1]]*isZee,0)+Alt$(Muon_eta[vLidx[1]]*isZmm,0) Alt$(Electron_pfRelIso03_all[vLidx[0]]*isZee,0)+Alt$(Muon_pfRelIso04_all[vLidx[0]]*isZmm,0) Alt$(Electron_pfRelIso03_all[vLidx[1]]*isZee,0)+Alt$(Muon_pfRelIso04_all[vLidx[1]]*isZmm,0) Alt$(Electron_phi[vLidx[0]]*isZee,0)+Alt$(Muon_phi[vLidx[0]]*isZmm,0) Alt$(Electron_phi[vLidx[1]]*isZee,0)+Alt$(Muon_phi[vLidx[1]]*isZmm,0) Alt$(Electron_pt[vLidx[0]]*isZee,0)+Alt$(Muon_pt[vLidx[0]]*isZmm,0) Alt$(Electron_pt[vLidx[1]]*isZee,0)+Alt$(Muon_pt[vLidx[1]]*isZmm,0) H_mass H_pt Jet_btagDeepB[hJidx[0]] Jet_btagDeepB[hJidx[1]] Jet_chEmEF[hJidx[0]] Jet_chEmEF[hJidx[1]] Jet_chHEF[hJidx[0]] Jet_chHEF[hJidx[1]] Jet_eta[hJidx[0]] Jet_eta[hJidx[1]] Jet_mass[hJidx[0]]*Jet_PtReg[hJidx[0]]/Jet_Pt[hJidx[0]] Jet_mass[hJidx[1]]*Jet_PtReg[hJidx[1]]/Jet_Pt[hJidx[1]] Jet_neEmEF[hJidx[0]] Jet_neEmEF[hJidx[1]] Jet_neHEF[hJidx[0]] Jet_neHEF[hJidx[1]] Jet_phi[hJidx[0]] Jet_phi[hJidx[1]] Jet_PtReg[hJidx[0]] Jet_PtReg[hJidx[1]] MaxIf$(Jet_btagDeepB[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_btagDeepB[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_btagDeepB[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_chEmEF[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_chEmEF[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_chEmEF[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_chHEF[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_chHEF[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_chHEF[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_eta[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_eta[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_eta[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_mass[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_mass[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_mass[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_neEmEF[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_neEmEF[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_neEmEF[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_neHEF[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_neHEF[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_neHEF[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_phi[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_phi[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_phi[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(Jet_Pt[aJidx_202p5[0]],aJidx_202p5[0]>=0) MaxIf$(Jet_Pt[aJidx_202p5[1]],aJidx_202p5[1]>=0) MaxIf$(Jet_Pt[aJidx_202p5[2]],aJidx_202p5[2]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[aJidx_202p5[0]],Jet_phi[aJidx_202p5[0]]),aJidx_202p5[0]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[aJidx_202p5[1]],Jet_phi[aJidx_202p5[1]]),aJidx_202p5[1]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[aJidx_202p5[2]],Jet_phi[aJidx_202p5[2]]),aJidx_202p5[2]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[1]],Jet_phi[hJidx[1]],Jet_eta[aJidx_202p5[0]],Jet_phi[aJidx_202p5[0]]),aJidx_202p5[0]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[1]],Jet_phi[hJidx[1]],Jet_eta[aJidx_202p5[1]],Jet_phi[aJidx_202p5[1]]),aJidx_202p5[1]>=0) MaxIf$(VHbb::deltaR(Jet_eta[hJidx[1]],Jet_phi[hJidx[1]],Jet_eta[aJidx_202p5[2]],Jet_phi[aJidx_202p5[2]]),aJidx_202p5[2]>=0) MET_Pt naJ_202p5 nFSRrecovered SA5 Sum$(Jet_PtReg>30&&abs(Jet_eta)<2.4&&(Jet_puId>6||Jet_Pt>50)&&Jet_jetId>0&&Jet_lepFilter>0) V_mass V_pt VHbb::deltaPhi(Alt$(Electron_phi[vLidx[0]]*isZee,0)+Alt$(Muon_phi[vLidx[0]]*isZmm,0),Alt$(Electron_phi[vLidx[1]]*isZee,0)+Alt$(Muon_phi[vLidx[1]]*isZmm,0)) VHbb::deltaR(Alt$(Electron_eta[vLidx[0]]*isZee,0)+Alt$(Muon_eta[vLidx[0]]*isZmm,0),Alt$(Electron_phi[vLidx[0]]*isZee,0)+Alt$(Muon_phi[vLidx[0]]*isZmm,0),Alt$(Electron_eta[vLidx[1]]*isZee,0)+Alt$(Muon_eta[vLidx[1]]*isZmm,0),Alt$(Electron_phi[vLidx[1]]*isZee,0)+Alt$(Muon_phi[vLidx[1]]*isZmm,0)) VHbb::deltaR(H_eta,H_phi,V_eta,V_phi) VHbb::deltaR(Jet_eta[hJidx[0]],Jet_phi[hJidx[0]],Jet_eta[hJidx[1]],Jet_phi[hJidx[1]]) VHbb::deltaR(V_eta,V_phi,Alt$(Electron_eta[vLidx[0]]*isZee,0)+Alt$(Muon_eta[vLidx[0]]*isZmm,0),Alt$(Electron_phi[vLidx[0]]*isZee,0)+Alt$(Muon_phi[vLidx[0]]*isZmm,0)) VHbb::deltaR(V_eta,V_phi,Alt$(Electron_eta[vLidx[1]]*isZee,0)+Alt$(Muon_eta[vLidx[1]]*isZmm,0),Alt$(Electron_phi[vLidx[1]]*isZee,0)+Alt$(Muon_phi[vLidx[1]]*isZmm,0)) VHbb::deltaR(V_eta,V_phi,Jet_eta[hJidx[0]],Jet_phi[hJidx[0]]) VHbb::deltaR(V_eta,V_phi,Jet_eta[hJidx[1]],Jet_phi[hJidx[1]]) 




;!! ------------------
;!! Boosted MVA 
;!! ------------------


[ZllBDTBOOSTVarsFinal_wdB]
Nominal: FatJet_msoftdrop_nom[Hbb_fjidx] FatJet_pt[Hbb_fjidx] MET_Pt V_mt SA5 FatJet_pt[Hbb_fjidx]/V_pt (1/(1+(FatJet_deepTagMD_TvsQCD[Hbb_fjidx]/FatJet_deepTagMD_HbbvsQCD[Hbb_fjidx])*(1-FatJet_deepTagMD_HbbvsQCD[Hbb_fjidx])/(1-FatJet_deepTagMD_TvsQCD[Hbb_fjidx])))>0.97


;;;;;;;;;;;;;;
;BDT Boost
;;;;;;;;;;;;;;
[BDT_Zll_BOOSTFinal_wdB]
MVAtype     = <!MVAGeneral|type!>
MVAsettings = NTrees=100:nCuts=20 
signals     = [<!Plot_general|trainingSig!>]
backgrounds = [<!Plot_general|trainingBKG!>]
;treeVarSet  = ZllBDTBOOSTVarsFinal_wdB
treeVarSet  = ZllBDTBOOSTVarsFinal_wdB
treeCut     = Signal_BOOSTv3
