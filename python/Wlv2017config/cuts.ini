[Cuts]

btagidx0 = <!General|btagidx0!>
btagidx1 = <!General|btagidx1!>

#additionalPlottingCut = (nAddJets302p5_puid<2) 

;CMVA settings
Jet_btag_CMVA = Jet_btagCMVA 
btagWP_Loose_CMVA = -0.5884
btagWP_Medium_CMVA = 0.4432
btagWP_Tight_CMVA = 0.9432
; DeepCSV
Jet_btag_DeepCSV = Jet_btagDeepB
btagWP_Loose_DeepCSV = 0.1522
btagWP_Medium_DeepCSV = 0.4941
btagWP_Tight_DeepCSV = 0.8001

; select WP depending on tagger selected in samples_nosplit.ini (The goal is to select from general.ini)
Jet_btag = <!Cuts|Jet_btag_<!General|btagMethod!>!>
btagWP_Loose = <!Cuts|btagWP_Loose_<!General|btagMethod!>!>
btagWP_Medium = <!Cuts|btagWP_Medium_<!General|btagMethod!>!>
btagWP_Tight = <!Cuts|btagWP_Tight_<!General|btagMethod!>!>

;% sign has to be escaped by %%
TrainCut = !((event%%2)==0||isData)
EvalCut = ((event%%2)==0||isData)
 
#-----  Jets cuts -----#
jetsPt = (<!General|bJet0PtReg!> > 25 && <!General|bJet1PtReg!> > 25)
jetsEta = (abs(<!General|bJet0Eta!>) < 2.5 && abs(<!General|bJet1Eta!>) < 2.5)

; Any new jets cuts on the jets should be added to the next line
jetsCuts= <!Cuts|jetsPt!> && <!Cuts|jetsEta!>

NaddJets = nAddJets302p5_puid 

#----Lepton Cuts----#

NaddLep = nAddLep15_2p5 
METsig = MET_Significance30 

#----- Muon -----#
MuonSel = isWmunu

#----- Electron -----#
ElectronSel  = isWenu

EandMuSelection = (<!Cuts|ElectronSel!> || <!Cuts|MuonSel!>)

#----- Basic Cut -----#

#no Dphi cuts
resolvedJets = (hJidx[0]>-1&&hJidx[1]>-1)
deltaPhiVH = abs(TVector2::Phi_mpi_pi(H_phi-V_phi))

BasicCuts = (<!Cuts|resolvedJets!>&&(isWenu||isWmunu)&&<!Cuts|jetsCuts!>&&<!General|diJetPt!> >100&&<!General|Vpt!> >150&&<!Cuts|NaddLep!>==0)

#----- Inclusive Region (e.g. for sample stitching) -----#
Incl        = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Loose!> && <!General|btag1!> > <!Cuts|btagWP_Loose!>)
Incle       = (<!Cuts|Incl!> && <!Cuts|ElectronSel!>)
Inclu       = (<!Cuts|Incl!> && <!Cuts|MuonSel!>)

#----- Vpt split -----#
med         = (V_pt >= 150.0 && V_pt < 250.0)
high        = (V_pt >= 250.0)
medhigh     = (V_pt >= 150.0)

#----- Control Region -----#
tt_basic    = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|diJetMass!><250 && <!Cuts|NaddJets!> > 1 && <!General|METpt!> < 170)
Whf_basic   = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|diJetMass!><250 && <!Cuts|NaddJets!> <= 1 && <!Cuts|METsig!> > 2.0 && (<!General|diJetMass!> > 150 || <!General|diJetMass!> < 90))
WhfhM_basic = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!Cuts|NaddJets!> <= 1 && <!Cuts|METsig!> > 2.0 && <!General|diJetMass!> > 150)
WhflM_basic = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!Cuts|NaddJets!> <= 1 && <!Cuts|METsig!> > 2.0 && <!General|diJetMass!> < 90)
Wlf_basic   = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Loose!> && <!General|btag0!> < <!Cuts|btagWP_Medium!> && <!General|diJetMass!><250 && <!Cuts|METsig!> > 2.0)

# for VZ analysis move mass window in control region
VV_Whf_basic = (<!Cuts|BasicCuts!> && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|diJetMass!><250 && <!Cuts|NaddJets!> <= 1 && <!Cuts|METsig!> > 2.0 && (<!General|diJetMass!> > 160 || <!General|diJetMass!> < 60))


#----- Control Region (medium) -----#
ttbar_med_Wln = <!Cuts|med!> && <!Cuts|tt_basic!>  && <!Cuts|EandMuSelection!>
ttbar_med_Wen = <!Cuts|med!> && <!Cuts|tt_basic!>  && <!Cuts|ElectronSel!>
ttbar_med_Wmn = <!Cuts|med!> && <!Cuts|tt_basic!>  && <!Cuts|MuonSel!>

Whf_med_Wln   = <!Cuts|med!> && <!Cuts|Whf_basic!> && <!Cuts|EandMuSelection!> 
Whf_med_Wen   = <!Cuts|med!> && <!Cuts|Whf_basic!> && <!Cuts|ElectronSel!>
Whf_med_Wmn   = <!Cuts|med!> && <!Cuts|Whf_basic!> && <!Cuts|MuonSel!>

Wlf_med_Wln   = <!Cuts|med!> && <!Cuts|Wlf_basic!> && <!Cuts|EandMuSelection!> 
Wlf_med_Wen   = <!Cuts|med!> && <!Cuts|Wlf_basic!> && <!Cuts|ElectronSel!>
Wlf_med_Wmn   = <!Cuts|med!> && <!Cuts|Wlf_basic!> && <!Cuts|MuonSel!>

VV_Whf_med_Wmn = <!Cuts|med!> && <!Cuts|VV_Whf_basic!> && <!Cuts|MuonSel!>
VV_Whf_med_Wen = <!Cuts|med!> && <!Cuts|VV_Whf_basic!> && <!Cuts|ElectronSel!>

#----- Control Region (high) -----#
ttbar_high_Wln = <!Cuts|high!> && <!Cuts|tt_basic!>  && <!Cuts|EandMuSelection!>
ttbar_high_Wen = <!Cuts|high!> && <!Cuts|tt_basic!>  && <!Cuts|ElectronSel!>
ttbar_high_Wmn = <!Cuts|high!> && <!Cuts|tt_basic!>  && <!Cuts|MuonSel!>

Whf_high_Wln   = <!Cuts|high!> && <!Cuts|Whf_basic!> && <!Cuts|EandMuSelection!>
Whf_high_Wen   = <!Cuts|high!> && <!Cuts|Whf_basic!> && <!Cuts|ElectronSel!>
Whf_high_Wmn   = <!Cuts|high!> && <!Cuts|Whf_basic!> && <!Cuts|MuonSel!>

Wlf_high_Wln   = <!Cuts|high!> && <!Cuts|Wlf_basic!> && <!Cuts|EandMuSelection!>
Wlf_high_Wen   = <!Cuts|high!> && <!Cuts|Wlf_basic!> && <!Cuts|ElectronSel!>
Wlf_high_Wmn   = <!Cuts|high!> && <!Cuts|Wlf_basic!> && <!Cuts|MuonSel!>

VV_Whf_high_Wmn = <!Cuts|high!> && <!Cuts|VV_Whf_basic!> && <!Cuts|MuonSel!>
VV_Whf_high_Wen = <!Cuts|high!> && <!Cuts|VV_Whf_basic!> && <!Cuts|ElectronSel!>

#----- Signal Region -----#
# AT sync:
# additional selection was made in AT (undocumented): H_pt_noFSR > 100
Sig_basic = (<!Cuts|BasicCuts!> && <!General|diJetMass!> > 90 && <!General|diJetMass!> < 150 && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|btag1!> > <!Cuts|btagWP_Loose!> && <!Cuts|NaddJets!> < 2 && <!Cuts|deltaPhiVH!> > 2.5 && dPhiLepMet < 2.0 && nAddLep15_2p5==0) 

SR_med_Wln  = <!Cuts|med!> && <!Cuts|Sig_basic!> && <!Cuts|EandMuSelection!>
SR_med_Wen  = <!Cuts|med!> && <!Cuts|Sig_basic!> && <!Cuts|ElectronSel!>
SR_med_Wmn  = <!Cuts|med!> && <!Cuts|Sig_basic!> && <!Cuts|MuonSel!>

VV_SR_med_Wen = <!Cuts|med!> && (<!Cuts|BasicCuts!> && <!General|diJetMass!> > 60 && <!General|diJetMass!> < 160 && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|btag1!> > <!Cuts|btagWP_Loose!> && <!Cuts|NaddJets!> < 2 && <!Cuts|deltaPhiVH!> > 2.5 && dPhiLepMet < 2.0 && nAddLep15_2p5==0) && <!Cuts|ElectronSel!>
VV_SR_med_Wmn = <!Cuts|med!> && (<!Cuts|BasicCuts!> && <!General|diJetMass!> > 60 && <!General|diJetMass!> < 160 && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|btag1!> > <!Cuts|btagWP_Loose!> && <!Cuts|NaddJets!> < 2 && <!Cuts|deltaPhiVH!> > 2.5 && dPhiLepMet < 2.0 && nAddLep15_2p5==0) && <!Cuts|MuonSel!>

SR_high_Wln  = <!Cuts|high!> && <!Cuts|Sig_basic!> && <!Cuts|EandMuSelection!>
SR_high_Wen  = <!Cuts|high!> && <!Cuts|Sig_basic!> && <!Cuts|ElectronSel!>
SR_high_Wmn  = <!Cuts|high!> && <!Cuts|Sig_basic!> && <!Cuts|MuonSel!>

SR_medhigh_Wln  = <!Cuts|medhigh!> && <!Cuts|Sig_basic!> && <!Cuts|EandMuSelection!>
SR_medhigh_Wen  = <!Cuts|medhigh!> && <!Cuts|Sig_basic!> && <!Cuts|ElectronSel!>
SR_medhigh_Wmn  = <!Cuts|medhigh!> && <!Cuts|Sig_basic!> && <!Cuts|MuonSel!>

VV_SR_high_Wen = <!Cuts|high!> && (<!Cuts|BasicCuts!> && <!General|diJetMass!> > 60 && <!General|diJetMass!> < 160 && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|btag1!> > <!Cuts|btagWP_Loose!> && <!Cuts|NaddJets!> < 2 && <!Cuts|deltaPhiVH!> > 2.5 && dPhiLepMet < 2.0 && nAddLep15_2p5==0) && <!Cuts|ElectronSel!>
VV_SR_high_Wmn = <!Cuts|high!> && (<!Cuts|BasicCuts!> && <!General|diJetMass!> > 60 && <!General|diJetMass!> < 160 && <!General|btag0!> > <!Cuts|btagWP_Tight!> && <!General|btag1!> > <!Cuts|btagWP_Loose!> && <!Cuts|NaddJets!> < 2 && <!Cuts|deltaPhiVH!> > 2.5 && dPhiLepMet < 2.0 && nAddLep15_2p5==0) && <!Cuts|MuonSel!>

#----- Multi Region -----#
Multi_basic = <!Cuts|resolvedJets!>&&<!General|diJetPt!>>100&&<!General|Vpt!>>150&&<!Cuts|removeBadEvents!>&&<!General|btag0!>><!Cuts|btagWP_Loose!>&&<!General|btag1!>><!Cuts|btagWP_Loose!>&&<!General|diJetMass!><250&&<!Cuts|NaddJets!><=3&&<!Cuts|METsig!>>2.0
Multi       = <!.|Multi_basic!> && <!.|EandMuSelection!> 
Multie      = <!.|Multi_basic!> && <!.|ElectronSel!>
Multiu      = <!.|Multi_basic!> && <!.|MuonSel!> 

Multi_WJets0b = <!.|Multi!>
Multi_WJets1b = <!.|Multi!>
Multi_WJets2b = <!.|Multi!>
Multi_ST      = <!.|Multi!>
Multi_TT      = <!.|Multi!>
Multi_VVHF    = <!.|Multi!>
Multi_VVLF    = <!.|Multi!>
Multi_VH      = <!.|Multi!>


